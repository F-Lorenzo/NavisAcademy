import{a as d,u as O,j as a,d as k,r as A,F as M,C as H,c as E,x as p,I,T as D,k as x,B as R,e as B,D as W,g as V,L as Q}from"./index.07d71d12.js";import{T as G}from"./TimePicker.07d6dd4b.js";const z=({date:e})=>{const n=e.date.toDate(),i=n.getHours(),u=n.getMinutes(),f=n.toLocaleDateString(),C=i.toString().padStart(2,"0"),h=u.toString().padStart(2,"0");return d("div",{className:"nextClass__info",children:[d("p",{className:"nextClass__date",children:["PROXIMA CLASE : ",f]}),d("p",{className:"nextClass__time",children:[C,":",h," HS"]}),d("p",{className:"nextClass__teacher",children:["Profesor: ",e.teacherName," ",e.teacherLastName," "]})]})},K=({myClass:e,linkToClass:n,userInfo:i})=>{const u=O(),f=e.date.toDate(),C=new Date;let h=f-C,c=60*1e3,N=60*c,m=24*N,s=Math.floor(h/m),l=Math.floor(h%m/N);const o=i.reprogramedThisMonth;let t=s<1&&l<4||o===2;return d("div",{className:"studentPanelActionButtons",children:[n?a("a",{href:n,target:"_blank",children:a("button",{className:"studentPanelButton active",children:"INICIAR CLASE"})}):a("button",{className:"studentPanelButton",onClick:()=>{swal("Ups!","Todavia no hay link para esta clase","error")},children:"INICIAR CLASE"}),a("a",{href:"https://www.blinklearning.com/v/1666102044/themes/tmpux/launch.php",target:"_blank",children:a("button",{className:"studentPanelButton active",children:"BLINK LEARNING"})}),a("button",{className:t?"studentPanelButton":"studentPanelButton active",onClick:()=>{o===2?swal("CUIDADO","Solo puedes reprogramar 2 clases por mes y ya las reprogramaste","error"):t?swal("Ya es tarde","Solo puedes reprogramar tu clase hasta 4 horas antes","error"):u("/Account/ReprogramClass")},children:"REPROGRAMAR CLASE"})]})},X=e=>{const n=O(),i=()=>{n("/MiCalendario")};return d("div",{className:"studentClassInfo__container",children:[a("div",{className:"studentClassInfo__remainingClases",children:d("p",{children:["CLASES DISPONIBLES: ",e.remainingClases]})}),a("button",{className:"studentPanelButton active",onClick:i,children:"Ver Calendario"})]})},Y=e=>{let n=0;e.actualClass!==0&&(n=e.completedClases/e.actualClass*100);let i=Math.round(n);return d("div",{className:"studentClassInfo__asistencia",children:[a("p",{className:"asistencia__title",children:"ASISTENCIA"}),d("p",{className:"asistencia__percent",children:[i,"%"]}),d("div",{className:"asistencia",children:[d("p",{children:[e.completedClases," Presentes"]}),d("p",{children:[e.absentedClases," Ausente"]})]})]})};const J=()=>{const{user:e}=k(),n=H();A.exports.useState(!1);const[i,u]=A.exports.useState([]),f=["lunes","martes","miercoles","jueves","viernes","sabado","domingo"],C={modification:!1,condition:"pending",teacher:"unasigned",remainingClases:e.misClases.remainingClases,studentUid:e.uid,studentEmail:e.email,studentName:e.form.name,studentLastName:e.form.lastName,studentPhoneNumber:e.form.phoneNumber,durationClass:e.form.durationClass},h={textNotification:"Programaste tus clases, en breve se te asiganara un profesor",notificationType:"Notificacion",checked:!1},c=async()=>{const s=["domingo","lunes","martes","miercoles","jueves","viernes","sabado"];let l=[];s.map((o,t)=>{let r=i.filter(S=>S.day===o);l.push(...r)});try{const o=E(),t=p(o,`Users/${e.uid}/myClasses/${e.uid}`);await I(t,{userWeek:l,...C});const r=p(o,`Classes/${e.uid}`);await I(r,{userWeek:l,...C});const S=p(o,`Users/${e.uid}/myNotifications/${e.uid}`);await I(S,{...h,timeStamp:n});const b=p(o,`Users/${e.uid}`);await D(b,{teacher:"pending",notifications:x(1),newbie:!1,myClassesId:e.uid}),swal("Muy Bien","Pronto se te asignara un profesor!","success")}catch(o){swal("UPS!",`${o.message}`,"error")}},N=()=>{let s=!1,l=0;i.length===0?swal("CUIDADO!","Debes seleccionar al menos un dia y un horario","error"):i.map(o=>{let t=o.time!==void 0,r=!1;if(o.timeDate){let S=o.timeDate;r=!isNaN(S.getTime())}(!t||!r)&&(swal("CUIDADO!","Debes eleccionar un horario","error"),l++)}),l===0&&i.length!=0&&(s=!0),s&&c()},m=s=>{let l=i.filter(t=>t.day===s.id),o=i.filter(t=>t.day!=s.id);l={day:s.id,time:s.timeString,timeDate:s.timeDate},o.push(l),u(o)};return a(M,{children:d("div",{className:"programar-clase-conteiner",children:[a("h5",{children:"Selecciona los dias y el horario en que quieres tomar tus clases"}),a("ul",{className:"day-list",children:f.map((s,l)=>{const[o,t]=A.exports.useState(!1);return d("div",{className:"day-time-button",children:[a("li",{className:o?"day-button clicked":"day-button",onClick:()=>{let r=i;o?r=r.filter(S=>S.day!=s):r.push({day:s,time:void 0}),t(!o),u(r)},children:s}),o&&a(G,{id:s,name:"time",onChange:m})]},l)})}),a("button",{className:"continue-button",onClick:N,children:"CONTINUAR"})]})})},Z=()=>{const{user:e}=k(),n=O(),i=e.form,u=async f=>{try{const C=E(),h=p(C,`Users/${e.uid}`);await D(h,{durationClass:f}),n("/Panel")}catch(C){swal("UPS!",`${C.message}`,"error")}};return a("div",{className:"MyFirstClasses__container",children:i.remainingClases>0?a("div",{children:a(J,{})}):a("div",{children:i.durationClass===0?d("div",{children:[d("div",{className:"MyfirstClasses__welcome",children:[a("h5",{children:"Bienvenido a NAVIS"}),a("p",{children:"Para empezar debes adquirir tu primer paquete de clases"}),a("p",{children:"Pero antes debes elegir entre clases de 30min o 50min"})]}),d("div",{className:"cards__container",children:[a("div",{className:"buy-card",children:d("ul",{children:[a("li",{className:"amount",children:"Clases de 30min "}),a("div",{children:a("button",{className:"button__Card",onClick:()=>u(30),children:"SELECCIONAR"})})]})}),a("div",{className:"buy-card",children:d("ul",{children:[a("li",{className:"amount",children:"Clases de 50min "}),a("div",{children:a("button",{className:"button__Card",onClick:()=>u(50),children:"SELECCIONAR"})})]})})]})]}):d("div",{children:[d("div",{className:"MyfirstClasses__welcome",children:[a("h5",{children:"Bienvenido a NAVIS"}),a("p",{children:"Adquiere tu primer paquete de clases"}),a("button",{className:"button__Card",onClick:()=>u(0),children:"ATRAS"})]}),a(R,{userDuration:i.durationClass})]})})})},q=async(e,n,i,u,f)=>{const C=[];let h=[];const c=E(),N=p(c,`Users/${e}/myClasses/${n}`),s=(await B(N)).data();let l=i.length;console.log(i),console.log(l);const o=s.userWeek.length;let t=l-o;const r=(U,w)=>{U.setDate(U.getDate()+w)};let S=0,b=1,_=l;for(let U=0;U<u;U++){S<o?S++:(S=1,b++);const w=i[t];console.log(t),console.log(w);let P=w.date.toDate(),L=w.dateEnd.toDate();r(P,7*b),r(L,7*b);const F={date:P,dateEnd:L,time:w.time,condition:"pending",linkToClass:"",teacherCalification:"",studentCalification:"",studentAssist:!1,reprogramed:!1,durationClass:s.durationClass,classNumber:_,calificationOfClass:"",studentName:s.studentName,studentLastName:s.studentLastName,studentUid:s.studentUid,studentEmail:s.studentEmail,teacherName:s.teacherName,teacherLastName:s.teacherLastName,teacherUid:s.teacherUid,teacherEmail:s.teacherEmail};C.push(F),t<l-1?t++:t=l-o,_++}h=[...i,...C],f===!1&&(u=0);const g=p(c,`Users/${e}/mySchedule/${n}`);await D(g,{...h});const v=p(c,`Users/${e}`);await D(v,{newPurchasedClasses:0});const y=p(c,`Classes/${n}`);await D(y,{remainingClases:x(u)});const $=p(c,`Users/${s.teacherUid}/mySchedule/${e}`);await D($,{...h});const T=p(c,`Users/${s.teacherUid}/myStudents/${e}`);await D(T,{remainingClases:x(u)})},ee=async(e,n,i)=>{console.log({teacherData:e,userId:n,teacherDataPath:i});const u=E(),f=p(u,`Users/${n}/myClasses/${n}`);await D(f,{...e,modification:!1}),await D(i,{modification:!1});const C=p(u,`Users/${n}`);await D(C,{teacherName:`${e.teacherName} ${e.teacherLastName}`,teacherPhoneNumber:`${e.teacherPhoneNumber}`});const h=p(u,`Users/${n}/mySchedule/${n}`),N=(await B(h)).data();for(let m in N)for(let s in N[m])switch(s){case"teacherName":N[m].teacherName=e[s];break;case"teacherLastName":N[m].teacherLastName=e[s];break}await D(h,{...N})},ae=async(e,n,i)=>{const u=E(),f=p(u,`Classes/${i}`),h=(await B(f)).data();h.modification===!0&&ee(h,i,f);const c=(g,v)=>{g.setDate(g.getDate()+v)},N=new Date;let m=e,s,l;const o=new Date;c(o,-1);const t=N.getMonth(),r=o.getMonth();t!==r&&(async()=>{const g=p(u,`Users/${i}`);await D(g,{reprogramedThisMonth:0})})();const b=async()=>{const g=p(u,`Users/${i}`);await D(g,{actualClass:m,linkToClass:""})},_=()=>{if(m>1){let g=0;for(let v=m-2;v<m+1;v++){const y=n[v];if(y.condition==="pending"){const $=y.dateEnd.toDate(),T=new Date;let U=$-T,w=60*1e3,P=60*w,L=24*P;Math.floor(U/L)!==0&&(y.condition="failed",g++)}}g>0&&q(i,i,n,g,!1)}};if(n.length!==0){_();let g=!0;if(l=n[m],l&&(s=l.dateEnd,s=s.toDate()),s){for(;g&&s<N;)m++,l=n[m],l===void 0?(g=!1,m--):(s=l.dateEnd,s=s.toDate());m!==e&&b()}}},ie=()=>{const{user:e}=k(),[n,i]=A.exports.useState([]),[u,f]=A.exports.useState(!0),[C,h]=A.exports.useState(),c=e.form;return A.exports.useEffect(()=>{f(!0);const N=E(),m=W(N,`Users/${e.uid}/mySchedule`);if(V(m).then(s=>{const l=s.docs.map(t=>({...t.data()})),o=[];l.forEach(t=>Object.keys(t).forEach(r=>o.push({classNumber:t[r].classNumber,condition:t[r].condition,date:t[r].date,dateEnd:t[r].dateEnd,durationClass:t[r].durationClass,linkToClass:t[r].linkToClass,reprogramed:t[r].reprogramed,studentAssist:t[r].studentAssist,studentCalification:t[r].studentCalification,studentEmail:t[r].studentEmail,studentLastName:t[r].studentLastName,studentName:t[r].studentName,studentUid:t[r].studentUid,teacherCalification:t[r].teacherCalification,teacherLastName:t[r].teacherLastName,teacherName:t[r].teacherName,teacherUid:t[r].teacherUid,time:t[r].time}))),i(o),h(e.form.actualClass),f(!1)}),c.newPurchasedClasses>0&&c.teacher==="assigned"){let s=!0;q(e.uid,c.myClassesId,n,c.newPurchasedClasses,s),console.log(e.uid,c.myClassesId,n,c.newPurchasedClasses)}},[e]),ae(e.form.actualClass,n,e.uid),u?a(Q,{}):a(M,{children:c.newbie?a(Z,{}):c.teacher==="assigned"?c.remainingClases===0?d("div",{children:[d("div",{className:"MyfirstClasses__welcome",children:[a("h5",{children:"NO QUEDAN CLASES DISPONIBLES"}),a("p",{children:"Puedes adquirir nuevas para seguir"})]}),a(R,{userDuration:c.durationClass,msg:"ADQUIERE MAS CLASES"})]}):d("div",{children:[d("div",{className:"nextClass__container",children:[a(z,{date:n[C]}),a(K,{myClass:n[C],linkToClass:c.linkToClass,userInfo:c}),a(Y,{...e.misClases})]}),a(X,{...e.misClases}),a(R,{userDuration:c.durationClass,msg:"ADQUIERE MAS CLASES"})]}):a("div",{children:d("div",{className:"MyfirstClasses__welcome",children:[a("h5",{children:"FELICITACIONES!"}),a("p",{children:"Pronto se te asignara un profesor"})]})})})};export{ie as default};
