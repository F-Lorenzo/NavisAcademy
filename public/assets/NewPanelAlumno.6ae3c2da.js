import{c as T,x as f,e as x,T as C,k as R,r as p,_ as S,d as V,D as y,g as j,j as m,L as F,a as A}from"./index.d087145b.js";const I=async(s,i,r,l)=>{const w=[];let U=[];const o=T(),d=f(o,`Users/${s}/myClasses/${i}`),t=(await x(d)).data();let n=r.length;console.log(r),console.log(n);const u=t.userWeek.length;let h=0;n>5&&(h=n-u);const e=(N,E)=>{N.setDate(N.getDate()+E)};let a=0,$=1,P=n;for(let N=0;N<l;N++){a<u?a++:(a=1,$++);const E=r[h];console.log(h),console.log(E);let b=E.date.toDate(),O=E.dateEnd.toDate();e(b,7*$),e(O,7*$);const z={date:b,dateEnd:O,time:E.time,condition:"pending",linkToClass:"",teacherCalification:"",studentCalification:"",studentAssist:!1,reprogramed:!1,durationClass:t.durationClass,classNumber:P,calificationOfClass:"",studentName:t.studentName,studentLastName:t.studentLastName,studentUid:t.studentUid,studentEmail:t.studentEmail,teacherName:t.teacherName,teacherLastName:t.teacherLastName,teacherUid:t.teacherUid,teacherEmail:t.teacherEmail};w.push(z),h<n-1?h++:h=n-u,P++}U=[...r,...w];const c=f(o,`Users/${s}/mySchedule/${i}`);await C(c,{...U});const _=f(o,`Users/${s}`);await C(_,{newPurchasedClasses:0});const g=f(o,`Classes/${i}`);await C(g,{remainingClases:R(l)});const v=f(o,`Users/${t.teacherUid}/mySchedule/${s}`);await C(v,{...U});const D=f(o,`Users/${t.teacherUid}/myStudents/${s}`);await C(D,{remainingClases:R(l)})},q=async(s,i,r)=>{const l=T(),w=f(l,`Classes/${r}`),o=(await x(w)).data();if(o.modification===!0){const c=f(l,`Users/${r}/myClasses/${r}`);await C(c,{...o,modification:!1}),await C(w,{modification:!1});const _=f(l,`Users/${r}`);await C(_,{teacherName:`${o.teacherName} ${o.teacherLastName}`,teacherPhoneNumber:`${o.teacherPhoneNumber}`});const g=f(l,`Users/${r}/mySchedule/${r}`),D=(await x(g)).data();for(let N in D)for(let E in D[N])switch(E){case"teacherName":D[N].teacherName=o[E];break;case"teacherLastName":D[N].teacherLastName=o[E];break}await C(g,{...D})}const d=(c,_)=>{c.setDate(c.getDate()+_)},L=new Date;let t=s,n,u;const h=new Date;d(h,-1);const e=L.getMonth(),a=h.getMonth(),$=async()=>{const c=f(l,`Users/${r}`);await C(c,{reprogramedThisMonth:0})},P=async()=>{const c=f(l,`Users/${r}`);await C(c,{actualClass:t,linkToClass:""})};if(e!==a&&$(),i){let c=!0;if(u=i[t],u&&(n=u.dateEnd,n=n.toDate()),n){for(;c&&n<L;)t++,u=i[t],u===void 0?(c=!1,t--):(n=u.dateEnd,n=n.toDate());t!==s&&P()}}if(t>1&&i){let c=0;for(let _=t-2;_<t;_++){const g=i[_];g.condition==="pending"&&c++,console.log({actualClass:t,evaluate:_,classToEvaluate:g,absentTeacher:c})}}},B=p.exports.lazy(()=>S(()=>import("./NextClassInfo.50a21e3c.js"),["assets/NextClassInfo.50a21e3c.js","assets/index.d087145b.js","assets/index.1534f841.css"])),W=p.exports.lazy(()=>S(()=>import("./StudentPanelActionButtons.2fb625af.js"),["assets/StudentPanelActionButtons.2fb625af.js","assets/index.d087145b.js","assets/index.1534f841.css"])),Q=p.exports.lazy(()=>S(()=>import("./StudentClassInfo.66465bdd.js"),["assets/StudentClassInfo.66465bdd.js","assets/index.d087145b.js","assets/index.1534f841.css"])),G=p.exports.lazy(()=>S(()=>import("./Asistencia.f14a57ee.js"),["assets/Asistencia.f14a57ee.js","assets/index.d087145b.js","assets/index.1534f841.css"])),H=p.exports.lazy(()=>S(()=>import("./MyFirstClasses.2477341e.js"),["assets/MyFirstClasses.2477341e.js","assets/MyFirstClasses.13b2538d.css","assets/index.d087145b.js","assets/index.1534f841.css","assets/TimePicker.70bfcf16.js","assets/TimePicker.f2069e86.css"])),J=p.exports.lazy(()=>S(()=>import("./index.d087145b.js").then(s=>s.f),["assets/index.d087145b.js","assets/index.1534f841.css"])),Z=()=>{const{user:s}=V(),[i,r]=p.exports.useState([]),[l,w]=p.exports.useState(!0),[U,o]=p.exports.useState(),d=s.form;return p.exports.useEffect(()=>{const L=T(),t=y(L,`Users/${s.uid}/mySchedule`);j(t).then(n=>{const u=n.docs.map(e=>({...e.data()})),h=[];u.forEach(e=>Object.keys(e).forEach(a=>h.push({classNumber:e[a].classNumber,condition:e[a].condition,date:e[a].date,dateEnd:e[a].dateEnd,durationClass:e[a].durationClass,linkToClass:e[a].linkToClass,reprogramed:e[a].reprogramed,studentAssist:e[a].studentAssist,studentCalification:e[a].studentCalification,studentEmail:e[a].studentEmail,studentLastName:e[a].studentLastName,studentName:e[a].studentName,studentUid:e[a].studentUid,teacherCalification:e[a].teacherCalification,teacherLastName:e[a].teacherLastName,teacherName:e[a].teacherName,teacherUid:e[a].teacherUid,time:e[a].time}))),r(h),o(s.form.actualClass),w(!1)})},[s]),d.newPurchasedClasses>0&&d.teacher==="assigned"&&(I(s.uid,d.myClassesId,i,d.newPurchasedClasses),console.log(s.uid,d.myClassesId,i,d.newPurchasedClasses)),q(s.form.actualClass,i,s.uid),l?m(F,{}):m(p.exports.Suspense,{fallback:m("div",{children:"Loading..."}),children:d.newbie?m(H,{}):d.teacher==="assigned"?A("div",{children:[A("div",{className:"nextClass__container",children:[m(B,{date:i[U]}),m(W,{myClass:i[U],linkToClass:d.linkToClass,userInfo:d}),m(G,{...s.misClases})]}),m(Q,{...s.misClases}),m(J,{userDuration:d.durationClass,msg:"ADQUIERE MAS CLASES"})]}):m("div",{children:A("div",{className:"MyfirstClasses__welcome",children:[m("h5",{children:"FELICITACIONES!"}),m("p",{children:"Pronto se te asignara un profesor"})]})})})};export{Z as default};
